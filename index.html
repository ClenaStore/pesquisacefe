<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pesquisa de Satisfação</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --panel:#111834; --muted:#8fa1ff; --text:#e8ecff; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --brand:#5865f2;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:linear-gradient(180deg,#0b1020 0%,#0e1430 100%);
      font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
    }
    .wrap{max-width:900px;margin:32px auto;padding:20px}
    .card{
      background:var(--panel);border:1px solid rgba(255,255,255,.06);
      border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    h1{margin:0 0 6px;font-weight:800;letter-spacing:.2px}
    .sub{margin:0 0 24px;color:var(--muted)}
    fieldset{border:0;margin:0 0 18px;padding:0}
    label{display:block;font-weight:600;margin:12px 0 8px}
    input[type="text"], input[type="tel"], input[type="number"], select, textarea{
      width:100%;background:#0a1130;border:1px solid rgba(255,255,255,.1);color:var(--text);
      padding:12px 14px;border-radius:12px;outline:none;font-size:14px
    }
    textarea{min-height:88px;resize:vertical}
    .row{display:grid;gap:12px}
    @media(min-width:720px){ .row.cols-3{grid-template-columns:1fr 1fr 1fr} .row.cols-2{grid-template-columns:1fr 1fr} }
    .options{display:grid;gap:8px;margin-top:6px}
    .opt{display:flex;align-items:center;gap:10px;padding:10px;border:1px solid rgba(255,255,255,.08);
      border-radius:12px;background:#0a1130;cursor:pointer}
    .opt input{transform:scale(1.15)}
    .hint{font-size:12px;color:#9fb0ff;margin-top:6px}
    .footer{display:flex;gap:12px;align-items:center;justify-content:flex-end;margin-top:18px}
    button{
      background:var(--brand);border:0;color:white;font-weight:700;padding:12px 18px;border-radius:12px;
      cursor:pointer;transition:transform .06s ease,opacity .2s ease
    }
    button:disabled{opacity:.6;cursor:not-allowed}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.14);color:var(--text)}
    .msg{margin-top:14px;padding:12px 14px;border-radius:12px;display:none;font-weight:600}
    .success{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.35);display:block}
    .error{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.35);display:block}
    .brandline{display:flex;align-items:center;gap:10px;margin-bottom:18px}
    .logo{width:40px;height:40px;border-radius:10px;background:#fff url('https://dummyimage.com/80x80/ffffff/000000&text=LG') center/cover no-repeat}
    .req{color:#fda4af;font-weight:700;margin-left:4px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brandline">
        <div class="logo" title="Sua logo"></div>
        <div>
          <h1>Pesquisa de Satisfação</h1>
          <p class="sub">Ajude-nos a melhorar respondendo as perguntas abaixo.</p>
        </div>
      </div>

      <form id="formPesquisa" autocomplete="on">
        <fieldset>
          <label>Nome e sobrenome <span class="req">*</span></label>
          <input name="nome" required placeholder="Digite seu nome completo" />
        </fieldset>

        <fieldset>
          <label>Qual a data de seu aniversário?</label>
          <div class="row cols-3">
            <input type="number" name="aniv_dia" placeholder="Dia" min="1" max="31" />
            <select name="aniv_mes">
              <option value="">Mês</option>
              <option>Janeiro</option><option>Fevereiro</option><option>Março</option><option>Abril</option>
              <option>Maio</option><option>Junho</option><option>Julho</option><option>Agosto</option>
              <option>Setembro</option><option>Outubro</option><option>Novembro</option><option>Dezembro</option>
            </select>
            <input type="number" name="aniv_ano" placeholder="Ano" min="1900" max="2100" />
          </div>
          <div class="hint">Ao nos informar a data, você pode concorrer a um presente de aniversário!</div>
        </fieldset>

        <fieldset>
          <label>Telefone</label>
          <input name="telefone" type="tel" placeholder="(00) 00000-0000" />
        </fieldset>

        <fieldset>
          <label>Em qual cidade mora? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="cidade" value="Barreiras - BA" required> Barreiras - BA</label>
            <label class="opt"><input type="radio" name="cidade" value="Luís Eduardo Magalhães - BA"> Luís Eduardo Magalhães - BA</label>
            <label class="opt">
              <input type="radio" name="cidade" value="Outra"> Outra
            </label>
          </div>
          <input id="cidadeOutra" name="cidade_outra" placeholder="Se escolheu Outra, informe a cidade" style="margin-top:8px;display:none" />
        </fieldset>

        <fieldset>
          <label>O que achou do nosso ambiente? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="ambiente" value="Ótimo" required> Ótimo</label>
            <label class="opt"><input type="radio" name="ambiente" value="Bom"> Bom</label>
            <label class="opt"><input type="radio" name="ambiente" value="Ruim"> Ruim</label>
          </div>
        </fieldset>

        <fieldset>
          <label>O que gostaria de ser adicionado ao nosso cardápio?</label>
          <textarea name="sugestao_cardapio" placeholder="Escreva aqui sua sugestão"></textarea>
        </fieldset>

        <fieldset>
          <label>Como estava a comida? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="comida" value="Ótima" required> Ótima</label>
            <label class="opt"><input type="radio" name="comida" value="Boa"> Boa</label>
            <label class="opt"><input type="radio" name="comida" value="Ruim"> Ruim</label>
          </div>
        </fieldset>

        <fieldset>
          <label>Como avalia o atendimento recebido? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="atendimento" value="Ótimo" required> Ótimo</label>
            <label class="opt"><input type="radio" name="atendimento" value="Bom"> Bom</label>
            <label class="opt"><input type="radio" name="atendimento" value="Ruim"> Ruim</label>
          </div>
        </fieldset>

        <fieldset>
          <label>O que achou da climatização? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="climatizacao" value="Ótima" required> Ótima</label>
            <label class="opt"><input type="radio" name="climatizacao" value="Boa"> Boa</label>
            <label class="opt"><input type="radio" name="climatizacao" value="Ruim"> Ruim</label>
          </div>
        </fieldset>

        <fieldset>
          <label>O que achou do nosso atendimento? <span class="req">*</span></label>
          <div class="options">
            <label class="opt"><input type="radio" name="atendimento_geral" value="Ótimas" required> Ótimas</label>
            <label class="opt"><input type="radio" name="atendimento_geral" value="Boas"> Boas</label>
            <label class="opt"><input type="radio" name="atendimento_geral" value="Ruins"> Ruins</label>
          </div>
        </fieldset>

        <fieldset>
          <label>Deixe uma sugestão</label>
          <textarea name="sugestao_geral" placeholder="Escreva livremente"></textarea>
        </fieldset>

        <div class="footer">
          <button type="button" class="ghost" id="btnLimpar">Limpar</button>
          <button id="btnEnviar" type="submit">Enviar resposta</button>
        </div>

        <div id="msg" class="msg"></div>
      </form>
    </div>
  </div>

<script>
const WEBAPP_URL = "YOUR_APPS_SCRIPT_WEBAPP_URL"; // <-- cole aqui a URL implantada (passo 2)

const form = document.getElementById('formPesquisa');
const btnEnviar = document.getElementById('btnEnviar');
const btnLimpar = document.getElementById('btnLimpar');
const msg = document.getElementById('msg');
const cidadeOutra = document.getElementById('cidadeOutra');

// Exibe campo "Outra cidade" quando necessário
form.cidade.forEach?.(r => {
  r.addEventListener('change', () => {
    cidadeOutra.style.display = (r.value === 'Outra' && r.checked) ? 'block' : 'none';
    if (cidadeOutra.style.display === 'none') cidadeOutra.value = '';
  });
});

// Máscara simples de telefone
form.telefone.addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g,'').slice(0,11);
  if (v.length >= 2) v = `(${v.slice(0,2)}) ${v.slice(2)}`;
  if (v.length >= 10) v = `(${v.slice(1,3)}) ${v.slice(4,9)}-${v.slice(9,13)}`;
  e.target.value = v;
});

btnLimpar.addEventListener('click', () => {
  form.reset();
  cidadeOutra.style.display = 'none';
  showMsg('', null);
});

form.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  showMsg('', null);

  // Validação leve extra
  if (!form.nome.value.trim()) return showMsg('Informe o nome completo.', 'error');
  if (!form.cidade.value) return showMsg('Selecione a cidade.', 'error');
  if (!form.ambiente.value || !form.comida.value || !form.atendimento.value || !form.climatizacao.value || !form.atendimento_geral.value) {
    return showMsg('Responda as perguntas obrigatórias.', 'error');
  }

  const payload = {
    nome: form.nome.value.trim(),
    aniv_dia: form.aniv_dia.value || '',
    aniv_mes: form.aniv_mes.value || '',
    aniv_ano: form.aniv_ano.value || '',
    telefone: form.telefone.value || '',
    cidade: form.cidade.value === 'Outra' ? (form.cidade_outra.value || 'Outra') : form.cidade.value,
    ambiente: form.ambiente.value,
    sugestao_cardapio: form.sugestao_cardapio.value || '',
    comida: form.comida.value,
    atendimento: form.atendimento.value,
    climatizacao: form.climatizacao.value,
    atendimento_geral: form.atendimento_geral.value,
    sugestao_geral: form.sugestao_geral.value || '',
    criado_em: new Date().toISOString()
  };

  try {
    toggleLoading(true);
    const res = await fetch(WEBAPP_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({action:'registrar_pesquisa', data: payload})
    });
    const json = await res.json();

    if (res.ok && json?.success) {
      showMsg('✅ Resposta enviada com sucesso! Obrigado pela participação.', 'success');
      form.reset(); cidadeOutra.style.display='none';
    } else {
      throw new Error(json?.message || 'Falha ao enviar.');
    }
  } catch (err) {
    console.error(err);
    showMsg('❌ Não foi possível enviar. Tente novamente.', 'error');
  } finally {
    toggleLoading(false);
  }
});

function toggleLoading(state){
  btnEnviar.disabled = state;
  btnEnviar.textContent = state ? 'Enviando…' : 'Enviar resposta';
}
function showMsg(text, type){
  msg.textContent = text;
  msg.className = 'msg' + (type ? ' ' + type : '');
  msg.style.display = text ? 'block' : 'none';
}
</script>
</body>
</html>
